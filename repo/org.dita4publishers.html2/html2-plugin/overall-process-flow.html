<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang=""><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Overall HTML Generation Process Flow</title><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="schema.DC" href="http://purl.org/dc/terms/"><meta name="DC.Type" content="concept"><meta name="DC.Title" content="Overall HTML Generation Process Flow"><meta name="abstract" content="Describes the overall processing flow for the HTML2 transformation"><meta name="description" content="Describes the overall processing flow for the HTML2 transformation"><meta name="DC.Relation" scheme="URI" content="../../org.dita4publishers.common.mapdriven/map-driven-processing/map-driven-processing.html"><meta name="DC.Relation" scheme="URI" content="html2-toolkit-plugin.html"><meta name="DC.Relation" scheme="URI" content="understanding-html2-transforms.html"><meta name="DC.Relation" scheme="URI" content="customizing-enumeration.html"><meta name="DC.Format" content="XHTML"><meta name="DC.Identifier" content="conceptId"><script type="text/javascript">var d4p = {"relativePath":"..\/..\/..\/","dev":false,"debug":false,"draft":false,"nextTopicHref":"repo\/org.dita4publishers.html2\/html2-plugin\/customizing-enumeration.html","previousTopicHref":"repo\/org.dita4publishers.html2\/html2-plugin\/understanding-html2-transforms.html","root":false,"topic":{"chunked":""},"map":{"title":"  DITA For Publishers User Guide  ","chunked":false},"search":{"minlength":2},"l":{"searchPageHeading":"Search Results","close":"Close"}}</script><link rel="stylesheet" type="text/css" media="screen, projection" href="../../../themes/dita-d4p-classic/css/style.css"><link rel="stylesheet" type="text/css" media="screen, projection, print" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"><script type="text/javascript">
      
        d4p.cssGridPath = d4p.dev ? 'html5-themes/modules/960-Responsive-Grid/css/' : 'themes/dita-d4p-classic/css/';
        var ADAPT_CONFIG = {
          // Where is your CSS?
          path: d4p.relativePath + d4p.cssGridPath,
          
          // false = Only run once, when page first loads.
          // true = Change on window resize and page tilt.
          dynamic: true,
          
          // Optional callback... myCallback(i, width)
          callback: doc_resize,
          
          // First range entry is the minimum.
          // Last range entry is the maximum.
          // Separate ranges by "to" keyword.
          range: [
             // small (size-0)
            '0px    to 760px  = mobile.css',
             // medium (size-1, size-2)
            '760px  to 980px  = 720.css',
            '980px  to 1270px = 960.css',
             // large (size-3, size-5)
            '1270px to 1600px = 1200.css',
            '1600px to 1940px = 1560.css',
             // extra large (size-6)
            '1940px to 2540px = 1920.css',
            '2540px           = 2520.css'
          ]
        };

        function doc_resize(i, width)
        {
          d4p.setBodyClassfunction(i, width);
        }


        
      </script><script type="text/javascript" src="../../../themes/dita-d4p-classic/js/script.js"></script></head><body class="en-us dita-d4p-classic centered navigation-default"><div id="d4h5-main-container" class="container_12" role="application"><ul id="page-links" class="hidden"><li><a id="skip-to-content" href="#d4h5-main-content">Skip to content</a></li><li><a id="skip-to-localnav" href="#local-navigation">Skip to navigation</a></li><li><a id="skip-to-footer" href="#footer">Skip to footer</a></li></ul><header role="banner" aria-labelledby="publication-title" class="hide-for-small"><div class="grid_8"><h1 id="publication-title">  DITA For Publishers User Guide  </h1></div><section class="grid_4 search-box"><form id="search" role="search"><div class="form-group"><input id="search-text" type="text" autocomplete="off" class="form-control" placeholder="Search"></div></form></section><secion class="clearfix"></secion></header><div id="d4h5-section-container" class="grid_12"><nav id="local-navigation" class="grid_4 alpha omega" role="navigation" aria-label="Main navigation"><div id="nav-content"><ul><li><a href="../../../index.html">Table of Contents</a></li><li><a href="../../../user_docs/d4p-users-guide/frontmatter/coverpage.html">DITA For Publishers User Guide</a></li><li><a href="../../../user_docs/d4p-users-guide/backmatter/colophon.html">Colophon</a></li></ul></div></nav><div id="d4h5-main-content" class="grid_8 alpha omega"><article><nav id="content-toolbar" class="toolbar hide-for-small"><div class="familylinks"><div xmlns:htmlutil="http://dita4publishers.org/functions/htmlutil" class="previouslink"><a href="../../org.dita4publishers.common.mapdriven/map-driven-processing/map-driven-processing.html" title="Map-Driven Processing"><span class="fi fi-arrow-left"></span><span class="screen-reader">Map-Driven Processing</span></a></div><div xmlns:htmlutil="http://dita4publishers.org/functions/htmlutil" class="nextlink"><a href="html2-toolkit-plugin.html" title="HTML2 Plugin"><span class="fi fi-arrow-right"></span><span class="screen-reader">HTML2 Plugin</span></a></div></div><div class="familylinks"><div xmlns:htmlutil="http://dita4publishers.org/functions/htmlutil" class="parentlink"><a href="understanding-html2-transforms.html" title="Understanding the HTML2 Transformations"><span class="fi fi-arrow-up"></span><span class="screen-reader">Understanding the HTML2 Transformations</span></a></div><div xmlns:htmlutil="http://dita4publishers.org/functions/htmlutil" class="nextlink"><a href="customizing-enumeration.html" title="Extending and Customizing Enumeration Processing (Numbering)"><span class="fi fi-arrow-right"></span><span class="screen-reader">Extending and Customizing Enumeration Processing (Numbering)</span></a></div></div></nav><section id="page"><div class="page concept    topic topic concept concept "><a name="conceptId" id="conceptId" class="anchor"></a>
 <h1 class="title topictitle1">Overall HTML Generation Process Flow</h1>
 
  
 <div class="body conbody"><p class="shortdesc">Describes the overall processing flow for the HTML2 transformation</p>
   <p class="p">The root transformation file is <span class="ph filepath">map2html2Impl.xsl</span>. This transform defines all the runtime parameters, sets up global variables and handles the initial map processing. It contains a simple passthrough template for "/" and the default-mode template for map.</p>
    <div class="p">The default-mode map template does the following tasks:<ul class="ul">
      <li class="li">Constructs a list of the graphics used within the publication</li>
      <li class="li">Constructs an intermediate file that maps the graphic locations as authored to their output locations relative to the generated HTML files. This allows the graphics to have different filenames and locations in the output (for example, all graphics can be put into a single output directory regardless of how they are stored for authoring).</li>
      <li class="li">Constructs an intermediate data set for the back-of-the-book index that can then be used to generate various renditions of the index.</li>
      <li class="li">Processes the map in the mode "generate-root-pages" in order to generate the root page or pages, such as the "index.html" file that contains navigation structures, a frameset if appropriate, and so on. This mode in turn does generation of static and dynamic tables of contents as selected by the runtime parameters. By default a dynamic ToC is generated and a static ToC is not.</li>
      <li class="li">Processes the map in the mode "generate-content", which manages the generation of HTML from topics as driven by the map structure.</li>
      <li class="li">Processes the map in the mode  "generate-index", which manages the generation of a back-of-the-book index as a separate HTML page or pages.</li>
      <li class="li">Processes the map in the mode "generate-graphic-copy-ant-script", which generates an Ant script that does the copying of graphics from their source locations to their output locations.</li>
      </ul></div>
    <p class="p">Most of this processing is fairly straightforward as it is simply processing of topicref-type elements in various contexts to produce different outputs. There is no particular non-obvious processing going on.</p>
    <p class="p">The non-obvious processing occurs for the processing of topics in the context of their references within the map. In order to enable use of base XSLT transforms for topics while still providing map-context-aware processing that can be overridden easily, the code uses a somewhat convoluted "double dispatch" method.</p>
    <p class="p">The XSLT file <span class="ph filepath">map2html2Context.xsl</span> iterates over the list of unique topic document references, as defined by the utility function df:getUniqueTopicrefs(), which takes into account chunking behavior. For each unique topic document reference, processing is applied in the mode "generate-content".</p>
    <p class="p">The template for topic references (as opposed to topic heads or topic groups) resolves the topicref to a topic document. It then first processes the topic in the mode "href-fixup", which is implemented by the common module "topicHrefFixup.xsl in the "org.dita4publishers.common.xslt" Toolkit plugin. That mode is an identity transform that rewrites all <code>@href</code> attribute values to reflect the eventual output locations of all the output files, resulting in an in-memory temporary topic document that is then processed in the mode "generate-content", passing the topicref element and result URI as tunnel parameters to the apply-templates call.</p>
    <p class="p">The generate-content template for topics then applies templates in the mode "map-driven-content-processing" to generate the initial no-namespace HTML file generated by the base HTML1 transforms, captured into a temporary variable. The no-namespace HTML is then processed in the mode "no-namespace-html-post-process" to produce the result file, which by default simply copies the no-namespace HTML to the output. You can override this mode to further process the HTML, for example to generate XHTML or HTML5 (as is done by the EPUB and HTML5 transforms, respectively).</p>
    <p class="p">The "map-driven-content-processing" template for topics checks to see whether or not the topicref parameter has a value. If it does, it applies templates in the mode "topicref-driven-content" to the topicref passed in as a parameter, passing the <em class="ph i">topic</em> as a parameter to apply templates. If the topicref parameter does not have a value, then it applies templates to the topic in the default mode, which has the effect of applying the normal HTML1 processing to topic in order to generate non-namespaced HTML.</p>
    <p class="p">The "topicref-driven-content" template for topicref then applies templates to the <em class="ph i">topic</em> in the default mode, passing the <em class="ph i">topicref</em> as a tunnel parameter. This has no effect on the (current) base HTML1 transforms but makes the topicref available to any extensions that choose to grab it.</p>
    <p class="p">The result URLs for files generated from topics (the HTML files) are determined by by the function htmlutil:getTopicResultUrl(). If the global file organization strategy is "single-dir" then the function calls the named template "get-topic-result-url-single-dir" otherwise it applies templates to the map in the mode "get-topic-result-url", which by default applies the "as-authored" strategy. You can implement your own template that matches on map/map in the "get-topic-result-url" mode or you can override the "get-topic-result-url-single-dir" template to implement your own output file organization strategy.</p>
    <p class="p">This rather convoluted processing chain is necessary in order to enable direct use of the HTML1 transforms with the option of map awareness. If the HTML1 transforms were reimplemented as XSLT2 transforms then at least some of this mode switching would not be necessary.</p>
    <p class="p">This profusion of XSTL modes also enables override and extension at several points and enables both pre-processing of the topics before they are sent to the HTML processing (by hooking the href-fixup mode) and post-processing of the initially-generated HTML (by overriding the no-namespace-html-post-process mode).</p>
 </div>
<div class="related-links"></div>
<footer id="topicsNPLinks"><div id="footer_previous"><a xmlns:htmlutil="http://dita4publishers.org/functions/htmlutil" href="../../../repo/org.dita4publishers.html2/html2-plugin/understanding-html2-transforms.html" class="previous" rel="internal">Understanding the HTML2 Transformations</a></div><div id="footer_next"><a xmlns:htmlutil="http://dita4publishers.org/functions/htmlutil" href="../../../repo/org.dita4publishers.html2/html2-plugin/customizing-enumeration.html" class="next" rel="internal">Extending and Customizing Enumeration Processing (Numbering)</a></div></footer></div></section></article><div class="clear"></div></div><div class="clearfix"></div></div><div class="clearfix"></div><div id="footer-container" class="grid_12"></div></div></body></html>